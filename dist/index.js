"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var s in n=arguments[e])Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,a,o,c){return new(o=o||Promise)(function(e,n){function r(t){try{i(c.next(t))}catch(t){n(t)}}function s(t){try{i(c.throw(t))}catch(t){n(t)}}function i(t){var n;t.done?e(t.value):((n=t.value)instanceof o?n:new o(function(t){t(n)})).then(r,s)}i((c=c.apply(t,a||[])).next())})},__generator=this&&this.__generator||function(e,r){var s,i,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:n(0),throw:n(1),return:n(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function n(n){return function(t){return function(n){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,i&&(a=2&n[0]?i.return:n[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,n[1])).done)return a;switch(i=0,(n=a?[2&n[0],a.value]:n)[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,i=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=r.call(e,o)}catch(t){n=[6,t],i=0}finally{s=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,t])}}};Object.defineProperty(exports,"__esModule",{value:!0});var analytics_next_1=require("@segment/analytics-next"),sensors=require("./sensors").default,AnalyticsBoom=function(){function t(t){this.options=__assign({channel_media:"",channel:""},t),this.userInfo={_id:"",name:"",phone:""},this.initTrack(),this.init()}return t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var n,e;return __generator(this,function(t){switch(t.label){case 0:return n="live"===this.options.env,[4,analytics_next_1.AnalyticsBrowser.load({writeKey:n?"GCNYIjqIBhkI4eA10HxDEGazuCMW69hM":"ryeevPxktAiS6AL1tjATM0s7iGf7piwM"})];case 1:return e=t.sent()[0],this.analytics=e,sensors.init({server_url:"https://weixi-boom.datasink.sensorsdata.cn/sa?token=edf9a6d8db338f69&project=".concat(n?"production":"default"),is_track_single_page:!0,use_client_time:!0,send_type:"beacon",heatmap:{clickmap:"default",scroll_notice_map:"not_collect"}}),sensors.quick("autoTrack"),sensors.registerPage({platform_type:this.options.platform_type,channel_media:this.options.channel_media,platform_version:this.options.platform_type,channel:this.options.channel}),this.sensors=sensors,[2]}})})},t.prototype.identify=function(){this.userInfo._id||(this.sensors&&this.sensors.login(this.userInfo._id),this.analytics&&this.analytics.identify(this.userInfo._id))},t.prototype.setUserInfo=function(t){this.userInfo=__assign({name:""},t)},t.prototype.initTrack=function(){var n=this;this.track={login:function(t){return n.trackInstance("login",t)},get_code:function(t){return n.trackInstance("get_code",t)},set_nickname:function(t){return n.trackInstance("set_nickname",t)},error_info:function(t){return n.trackInstance("error_info",t)},video_comment_click:function(t){return n.trackInstance("video_comment_click",t)},start_comment:function(t){return n.trackInstance("start_comment",t)},media_access_result:function(t){return n.trackInstance("media_access_result",t)},open_annotation:function(t){return n.trackInstance("open_annotation",t)},comment_status:function(t){return n.trackInstance("comment_status",t)},setting_panel:function(t){return n.trackInstance("setting_panel",t)},start_record:function(t){return n.trackInstance("start_record",t)},assist_operate:function(t){return n.trackInstance("assist_operate",t)},record_status:function(t){return n.trackInstance("record_status",t)},check_update:function(t){return n.trackInstance("check_update",t)},download_update:function(t){return n.trackInstance("download_update",t)},install_update:function(t){return n.trackInstance("install_update",t)},update_result:function(t){return n.trackInstance("update_result",t)},exit_update:function(t){return n.trackInstance("exit_update",t)},item_click:function(t){return n.trackInstance("item_click",t)},prd_pageview:function(t){return n.trackInstance("prd_pageview",t)},official_pageview:function(t){return n.trackInstance("official_pageview",t)}}},t.prototype.trackInstance=function(t,n){var e=n.description||"";delete n.description,this.sensors&&this.sensors.track(t,n),this.analytics&&this.analytics.track(t,__assign(__assign({general_attr:{platform:{name:this.options.platform_type,version:this.options.platform_version},user_info:{id:this.userInfo._id,name:this.userInfo.name,phone:this.userInfo.phone}}},n),{description:"用户 <".concat(this.userInfo.name||"","> ").concat(e)}))},t.prototype.getAnonymousId=function(){return{segment_id:(localStorage.getItem("ajs_anonymous_id")||"").replace(/"/g,""),sensors_id:this.sensors?this.sensors.quick("getAnonymousID"):""}},t}();exports.default=AnalyticsBoom;