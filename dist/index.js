"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,a,o,c){return new(o=o||Promise)(function(n,e){function r(t){try{s(c.next(t))}catch(t){e(t)}}function i(t){try{s(c.throw(t))}catch(t){e(t)}}function s(t){var e;t.done?n(t.value):((e=t.value)instanceof o?e:new o(function(t){t(e)})).then(r,i)}s((c=c.apply(t,a||[])).next())})},__generator=this&&this.__generator||function(n,r){var i,s,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,s&&(a=2&e[0]?s.return:e[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,e[1])).done)return a;switch(s=0,(e=a?[2&e[0],a.value]:e)[0]){case 0:case 1:a=e;break;case 4:return o.label++,{value:e[1],done:!1};case 5:o.label++,s=e[1],e=[0];continue;case 7:e=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===e[0]||2===e[0])){o=0;continue}if(3===e[0]&&(!a||e[1]>a[0]&&e[1]<a[3])){o.label=e[1];break}if(6===e[0]&&o.label<a[1]){o.label=a[1],a=e;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(e);break}a[2]&&o.ops.pop(),o.trys.pop();continue}e=r.call(n,o)}catch(t){e=[6,t],s=0}finally{i=a=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Log=void 0;var analytics_next_1=require("@segment/analytics-next"),axios_1=require("axios");function timeout(e){return new Promise(function(t){return setTimeout(t,e)})}var AnalyticsBoom=function(){function t(t){this.options=__assign({channel_media:"",channel:""},t),this.userInfo={_id:"",name:"",phone:""},this.initTrack(),this.init()}return t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var e,n,r;return __generator(this,function(t){switch(t.label){case 0:return e="live"===this.options.env,n=require("./sensors").default,window.analytics={_cdn:"https://oss.flix.visionwx.com/vendor_lib"},[4,analytics_next_1.AnalyticsBrowser.load({writeKey:e?"GCNYIjqIBhkI4eA10HxDEGazuCMW69hM":"ryeevPxktAiS6AL1tjATM0s7iGf7piwM"})];case 1:return r=t.sent()[0],this.analytics=r,n.init({server_url:"https://weixi-boom.datasink.sensorsdata.cn/sa?token=edf9a6d8db338f69&project=".concat(e?"production":"default"),is_track_single_page:!0,use_client_time:!0,send_type:"beacon",heatmap:{clickmap:"default",scroll_notice_map:"not_collect"},show_log:this.options.show_log||!1}),n.quick("autoTrack"),n.registerPage({platform_type:this.options.platform_type,channel_media:this.options.channel_media,platform_version:this.options.platform_version,channel:this.options.channel}),this.sensors=n,[2]}})})},t.prototype.identify=function(){this.userInfo._id&&(this.sensors&&this.sensors.login(this.userInfo._id),this.analytics&&this.analytics.identify(this.userInfo._id))},t.prototype.setUserInfo=function(t){this.userInfo=__assign({name:""},t)},t.prototype.initTrack=function(){var t=this;this.track={login:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("login",e)];case 1:return[2,t.sent()]}})})},get_code:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("get_code",e)];case 1:return[2,t.sent()]}})})},set_nickname:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("set_nickname",e)];case 1:return[2,t.sent()]}})})},error_info:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("error_info",e)];case 1:return[2,t.sent()]}})})},video_comment_click:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("video_comment_click",e)];case 1:return[2,t.sent()]}})})},start_comment:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("start_comment",e)];case 1:return[2,t.sent()]}})})},media_access_result:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("media_access_result",e)];case 1:return[2,t.sent()]}})})},open_annotation:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("open_annotation",e)];case 1:return[2,t.sent()]}})})},comment_status:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("comment_status",e)];case 1:return[2,t.sent()]}})})},setting_panel:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("setting_panel",e)];case 1:return[2,t.sent()]}})})},start_record:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("start_record",e)];case 1:return[2,t.sent()]}})})},assist_operate:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("assist_operate",e)];case 1:return[2,t.sent()]}})})},record_status:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("record_status",e)];case 1:return[2,t.sent()]}})})},check_update:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("check_update",e)];case 1:return[2,t.sent()]}})})},download_update:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("download_update",e)];case 1:return[2,t.sent()]}})})},install_update:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("install_update",e)];case 1:return[2,t.sent()]}})})},update_result:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("update_result",e)];case 1:return[2,t.sent()]}})})},exit_update:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("exit_update",e)];case 1:return[2,t.sent()]}})})},item_click:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("item_click",e)];case 1:return[2,t.sent()]}})})},prd_pageview:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("prd_pageview",e)];case 1:return[2,t.sent()]}})})},official_pageview:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("official_pageview",e)];case 1:return[2,t.sent()]}})})},extension_installed:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("extension_installed",e)];case 1:return[2,t.sent()]}})})},extension_uninstalled:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("extension_uninstalled",e)];case 1:return[2,t.sent()]}})})},share_screen:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("share_screen",e)];case 1:return[2,t.sent()]}})})},cancel_share_screen:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("cancel_share_screen",e)];case 1:return[2,t.sent()]}})})},extension_open:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("extension_open",e)];case 1:return[2,t.sent()]}})})},extension_crash:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("extension_crash",e)];case 1:return[2,t.sent()]}})})},clip_start:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("clip_start",e)];case 1:return[2,t.sent()]}})})},clip_operate:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("clip_operate",e)];case 1:return[2,t.sent()]}})})},clip_save:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("clip_save",e)];case 1:return[2,t.sent()]}})})},clip_cancel:function(e){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("clip_cancel",e)];case 1:return[2,t.sent()]}})})}}},t.prototype.trackInstance=function(r,i){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(t){switch(t.label){case 0:return e=i.description||"",this.beforeTrack&&"function"==typeof this.beforeTrack&&this.beforeTrack(i.description),delete i.description,this.sensors&&this.analytics?[3,2]:[4,timeout(80)];case 1:t.sent(),t.label=2;case 2:return t.trys.push([2,4,,5]),this.sensors.track(r,i),[4,this.analytics.track(r,__assign(__assign({general_attr:{platform:{name:this.options.platform_type,version:this.options.platform_version},user_info:{id:this.userInfo._id,name:this.userInfo.name,phone:this.userInfo.phone},extra_data:this.options.extra_data}},i),{description:"用户 <".concat(this.userInfo.name||"","> ").concat(e)}))];case 3:return n=t.sent(),this.afterTrack&&"function"==typeof this.afterTrack&&this.afterTrack(e),[2,n];case 4:return t.sent(),[2,!1];case 5:return[2]}})})},t.prototype.getAnonymousId=function(){return{segment_id:(localStorage.getItem("ajs_anonymous_id")||"").replace(/"/g,""),segment_user_id:(localStorage.getItem("ajs_user_id")||"").replace(/"/g,""),sensors_id:this.sensors?this.sensors.quick("getAnonymousID"):""}},t.prototype.setExtraData=function(t){this.options.extra_data=t},t.prototype.setProfile=function(t){this.sensors&&this.sensors.setProfile(t)},t.prototype.setBeforeTrack=function(t){this.beforeTrack=t},t.prototype.setAfterTrack=function(t){this.afterTrack=t},t}();exports.default=AnalyticsBoom;var Log=function(){function t(t){this.userInfo={_id:"unknown",name:"",phone:"",country_code:""},this.analyticsInfo={"sensors-distinct-id":"",ajs_anonymous_id:"",ajs_user_id:""},this.options=t,this.initAxios()}return t.prototype.initAxios=function(){var t=axios_1.default.create({baseURL:"live"===this.options.env?"https://api.flix.visionwx.com":"https://api.tf.visionwx.com",timeout:12e4});t.interceptors.response.use(function(t){return t.data},function(t){return Promise.reject(t)}),this.axios=t},t.prototype.setUserInfo=function(t){this.userInfo=__assign({name:""},t)},t.prototype.setAnalyticsInfo=function(t){this.analyticsInfo=__assign(__assign({},this.analyticsInfo),t)},t.prototype.debug=function(n){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=n.logTag||"info",delete n.logTag,[4,this.request("DEBUG",e,n)];case 1:return[2,t.sent()]}})})},t.prototype.info=function(n){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=n.logTag||"info",delete n.logTag,[4,this.request("INFO",e,n)];case 1:return[2,t.sent()]}})})},t.prototype.warn=function(n){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=n.logTag||"info",delete n.logTag,[4,this.request("WARN",e,n)];case 1:return[2,t.sent()]}})})},t.prototype.error=function(n){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=n.logTag||"info",delete n.logTag,[4,this.request("ERROR",e,n)];case 1:return[2,t.sent()]}})})},t.prototype.request=function(r,i,s){var a;return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(t){switch(t.label){case 0:return e="/mgmt/logs/app?userId=".concat(this.userInfo._id,"&application=").concat(this.options.platform_type,"&version=").concat(this.options.platform_version,"&logTag=").concat(i),n={content:s.content||"",level:r,extraData:__assign(__assign({},s.extraData||{}),{userInfo:{id:this.userInfo._id,name:this.userInfo.name,phone:this.userInfo.phone,country_code:this.userInfo.country_code},boomInfo:__assign({},null===(a=s.extraData)||void 0===a?void 0:a.boomInfo),analyticsInfo:this.analyticsInfo,sentAt:(new Date).toISOString()}),timestamp:Date.now(),timezoneOffset:0-(new Date).getTimezoneOffset()/60},[4,this.axios.post(e,n)];case 1:return[2,t.sent()]}})})},t}();exports.Log=Log;