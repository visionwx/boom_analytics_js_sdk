"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var i in n=arguments[e])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(t,a,o,c){return new(o=o||Promise)(function(e,n){function r(t){try{s(c.next(t))}catch(t){n(t)}}function i(t){try{s(c.throw(t))}catch(t){n(t)}}function s(t){var n;t.done?e(t.value):((n=t.value)instanceof o?n:new o(function(t){t(n)})).then(r,i)}s((c=c.apply(t,a||[])).next())})},__generator=this&&this.__generator||function(e,r){var i,s,a,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},t={next:n(0),throw:n(1),return:n(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function n(n){return function(t){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,s&&(a=2&n[0]?s.return:n[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,n[1])).done)return a;switch(s=0,(n=a?[2&n[0],a.value]:n)[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,s=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(a=0<(a=o.trys).length&&a[a.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=r.call(e,o)}catch(t){n=[6,t],s=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,t])}}};Object.defineProperty(exports,"__esModule",{value:!0});var analytics_next_1=require("@segment/analytics-next"),sensors=require("./sensors").default,AnalyticsBoom=function(){function t(t){this.options=__assign({channel_media:"",channel:""},t),this.userInfo={_id:"",name:"",phone:""},this.initTrack(),this.init()}return t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var n,e;return __generator(this,function(t){switch(t.label){case 0:return n="live"===this.options.env,window.analytics={_cdn:"https://oss.flix.visionwx.com/vendor_lib"},[4,analytics_next_1.AnalyticsBrowser.load({writeKey:n?"GCNYIjqIBhkI4eA10HxDEGazuCMW69hM":"ryeevPxktAiS6AL1tjATM0s7iGf7piwM"})];case 1:return e=t.sent()[0],this.analytics=e,sensors.init({server_url:"https://weixi-boom.datasink.sensorsdata.cn/sa?token=edf9a6d8db338f69&project=".concat(n?"production":"default"),is_track_single_page:!0,use_client_time:!0,send_type:"beacon",heatmap:{clickmap:"default",scroll_notice_map:"not_collect"}}),sensors.quick("autoTrack"),sensors.registerPage({platform_type:this.options.platform_type,channel_media:this.options.channel_media,platform_version:this.options.platform_version,channel:this.options.channel}),this.sensors=sensors,[2]}})})},t.prototype.identify=function(){this.userInfo._id&&(this.sensors&&this.sensors.login(this.userInfo._id),this.analytics&&this.analytics.identify(this.userInfo._id))},t.prototype.setUserInfo=function(t){this.userInfo=__assign({name:""},t)},t.prototype.initTrack=function(){var t=this;this.track={login:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("login",n)];case 1:return[2,t.sent()]}})})},get_code:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("get_code",n)];case 1:return[2,t.sent()]}})})},set_nickname:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("set_nickname",n)];case 1:return[2,t.sent()]}})})},error_info:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("error_info",n)];case 1:return[2,t.sent()]}})})},video_comment_click:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("video_comment_click",n)];case 1:return[2,t.sent()]}})})},start_comment:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("start_comment",n)];case 1:return[2,t.sent()]}})})},media_access_result:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("media_access_result",n)];case 1:return[2,t.sent()]}})})},open_annotation:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("open_annotation",n)];case 1:return[2,t.sent()]}})})},comment_status:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("comment_status",n)];case 1:return[2,t.sent()]}})})},setting_panel:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("setting_panel",n)];case 1:return[2,t.sent()]}})})},start_record:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("start_record",n)];case 1:return[2,t.sent()]}})})},assist_operate:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("assist_operate",n)];case 1:return[2,t.sent()]}})})},record_status:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("record_status",n)];case 1:return[2,t.sent()]}})})},check_update:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("check_update",n)];case 1:return[2,t.sent()]}})})},download_update:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("download_update",n)];case 1:return[2,t.sent()]}})})},install_update:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("install_update",n)];case 1:return[2,t.sent()]}})})},update_result:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("update_result",n)];case 1:return[2,t.sent()]}})})},exit_update:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("exit_update",n)];case 1:return[2,t.sent()]}})})},item_click:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("item_click",n)];case 1:return[2,t.sent()]}})})},prd_pageview:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("prd_pageview",n)];case 1:return[2,t.sent()]}})})},official_pageview:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("official_pageview",n)];case 1:return[2,t.sent()]}})})},installed:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("installed",n)];case 1:return[2,t.sent()]}})})},uninstalled:function(n){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.trackInstance("uninstalled",n)];case 1:return[2,t.sent()]}})})}}},t.prototype.trackInstance=function(r,i){return __awaiter(this,void 0,void 0,function(){var n,e;return __generator(this,function(t){switch(t.label){case 0:return n=i.description||"",this.beforeTrack&&"function"==typeof this.beforeTrack&&this.beforeTrack(i.description),delete i.description,this.sensors&&this.sensors.track(r,i),this.analytics?[4,this.analytics.track(r,__assign(__assign({general_attr:{platform:{name:this.options.platform_type,version:this.options.platform_version},user_info:{id:this.userInfo._id,name:this.userInfo.name,phone:this.userInfo.phone},extra_data:this.options.extra_data}},i),{description:"用户 <".concat(this.userInfo.name||"","> ").concat(n)}))]:[3,2];case 1:return e=t.sent(),this.afterTrack&&"function"==typeof this.afterTrack&&this.afterTrack(n),[2,e];case 2:return[2,!1]}})})},t.prototype.getAnonymousId=function(){return{segment_id:(localStorage.getItem("ajs_anonymous_id")||"").replace(/"/g,""),sensors_id:this.sensors?this.sensors.quick("getAnonymousID"):""}},t.prototype.setExtraData=function(t){this.options.extra_data=t},t.prototype.setProfile=function(t){this.sensors&&this.sensors.setProfile(t)},t.prototype.setBeforeTrack=function(t){this.beforeTrack=t},t.prototype.setAfterTrack=function(t){this.afterTrack=t},t}();exports.default=AnalyticsBoom;